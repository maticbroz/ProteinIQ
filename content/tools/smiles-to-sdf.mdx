## What is SMILES?

**SMILES** (Simplified Molecular Input Line Entry System) is a line notation for describing the structure of chemical molecules using short ASCII strings. SMILES represents a molecule's connectivity and stereochemistry in a compact, human-readable format.

Key features of SMILES:

- **Compact representation**: Complex molecules in short strings
- **Connectivity focus**: Describes bonds and atoms, not 3D coordinates
- **Standardized notation**: Widely supported across chemistry software
- **Text-based**: Easy to store, search, and manipulate

### SMILES syntax examples:

```
CCO                    # Ethanol
C1CCCCC1              # Benzene (aromatic)
CC(=O)O               # Acetic acid
C1CCC(CC1)N          # Cyclohexylamine
CN1C=NC2=C1C(=O)N(C(=O)N2C)C  # Caffeine
```

### SMILES notation rules:

- **Atoms**: Represented by atomic symbols (C, N, O, etc.)
- **Bonds**: Single bonds implicit, = for double, # for triple
- **Branches**: Parentheses () indicate branches
- **Rings**: Numbers indicate ring closures (1-9)
- **Aromatic**: Lowercase letters for aromatic atoms (c, n, o)
- **Charges**: [O-] for negative, [NH3+] for positive

## What is SDF?

**SDF** (Structure Data Format) is a chemical file format that stores molecular structures with 3D coordinates, connectivity information, and associated properties. SDF is the standard format for molecular databases and computational chemistry applications.

SDF consists of multiple blocks:

- **Header block**: Molecule name and metadata (3 lines)
- **Counts line**: Number of atoms and bonds
- **Atom block**: 3D coordinates and atom properties
- **Bond block**: Connectivity and bond types
- **Properties block**: Additional molecular data

### Example SDF structure:

```
Ethanol
  Generated from SMILES

  3  2  0  0  0  0  0  0  0  0999 V2000
    0.0000    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
    1.5400    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0
    2.0700    1.0600    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0
  1  2  1  0  0  0  0
  2  3  1  0  0  0  0
M  END
$$$$
```

## The conversion challenge

Converting SMILES to SDF involves a fundamental challenge: **SMILES contains no 3D coordinate information**. SMILES describes connectivity, while SDF requires explicit 3D atomic coordinates.

### Key conversion steps:

1. **Parse SMILES**: Extract atoms, bonds, and molecular graph
2. **Generate conformers**: Create 3D coordinates from 2D connectivity
3. **Optimize geometry**: Minimize energy and resolve conflicts
4. **Format output**: Write proper SDF format with metadata

### 3D coordinate generation methods:

**Distance Geometry:**

- Generate random coordinates satisfying distance constraints
- Use known bond lengths and angles
- Optimize to minimize clashes

**Template-based:**

- Match molecular fragments to known 3D templates
- Assemble fragments with proper geometry
- Refine overall conformation

**Molecular mechanics:**

- Apply force field calculations
- Minimize energy to find stable conformations
- Consider stereochemistry and ring strain

## Programming examples

### Using RDKit (Python)

RDKit is the gold standard for cheminformatics and SMILES to SDF conversion:

```python
from rdkit import Chem
from rdkit.Chem import AllChem
import sys

def smiles_to_sdf(smiles_file, sdf_file, conf_gen=True):
    """Convert SMILES file to SDF with 3D coordinates."""

    supplier = Chem.SmilesMolSupplier(smiles_file, titleLine=False)
    writer = Chem.SDWriter(sdf_file)

    processed = 0
    failed = 0

    for mol in supplier:
        if mol is None:
            failed += 1
            continue

        try:
            # Add hydrogens
            mol = Chem.AddHs(mol)

            if conf_gen:
                # Generate 3D conformer
                result = AllChem.EmbedMolecule(mol, randomSeed=42)
                if result != 0:
                    print(f"Warning: Could not generate 3D coordinates for molecule {processed + 1}")
                else:
                    # Optimize geometry
                    AllChem.MMFFOptimizeMolecule(mol)

            writer.write(mol)
            processed += 1

        except Exception as e:
            print(f"Error processing molecule {processed + 1}: {e}")
            failed += 1

    writer.close()
    print(f"Processed: {processed}, Failed: {failed}")

# Usage
smiles_to_sdf('molecules.smi', 'molecules.sdf')
```

### Batch processing with conformer generation

```python
from rdkit import Chem
from rdkit.Chem import AllChem, rdDistGeom
import pandas as pd

def batch_smiles_to_sdf_with_props(input_file, output_file, num_confs=1):
    """Advanced SMILES to SDF conversion with multiple conformers."""

    # Read SMILES with names
    df = pd.read_csv(input_file, sep='\t', names=['SMILES', 'Name'])

    writer = Chem.SDWriter(output_file)
    stats = {'success': 0, 'failed': 0}

    for idx, row in df.iterrows():
        smiles = row['SMILES']
        name = row.get('Name', f'mol_{idx}')

        try:
            # Parse SMILES
            mol = Chem.MolFromSmiles(smiles)
            if mol is None:
                raise ValueError(f"Invalid SMILES: {smiles}")

            # Add hydrogens
            mol = Chem.AddHs(mol)

            # Set molecule name
            mol.SetProp('_Name', str(name))
            mol.SetProp('SMILES', smiles)

            # Generate multiple conformers
            conf_ids = AllChem.EmbedMultipleConfs(
                mol,
                numConfs=num_confs,
                randomSeed=42,
                pruneRmsThresh=0.5
            )

            if not conf_ids:
                # Fallback to single conformer
                result = AllChem.EmbedMolecule(mol, randomSeed=42)
                if result != 0:
                    raise ValueError("Could not generate coordinates")
                conf_ids = [0]

            # Optimize each conformer
            for conf_id in conf_ids:
                try:
                    AllChem.MMFFOptimizeMolecule(mol, confId=conf_id)
                except:
                    pass  # Continue even if optimization fails

            # Write best conformer (first one after optimization)
            mol.SetProp('Conformers', str(len(conf_ids)))
            writer.write(mol, confId=conf_ids[0])
            stats['success'] += 1

        except Exception as e:
            print(f"Failed to process {name} ({smiles}): {e}")
            stats['failed'] += 1

    writer.close()
    print(f"Conversion complete: {stats['success']} success, {stats['failed']} failed")
    return stats

# Usage
batch_smiles_to_sdf_with_props('input.txt', 'output.sdf', num_confs=5)
```

### Using OpenBabel (Python)

Alternative approach using OpenBabel:

```python
import openbabel as ob
import sys

def smiles_to_sdf_openbabel(smiles_list, output_file):
    """Convert SMILES to SDF using OpenBabel."""

    obConversion = ob.OBConversion()
    obConversion.SetInAndOutFormats("smi", "sdf")

    # Enable 3D coordinate generation
    obConversion.AddOption("gen3d", ob.OBConversion.OUTOPTIONS)

    mol = ob.OBMol()
    writer = ob.OBConversion()
    writer.SetOutFormat("sdf")

    with open(output_file, 'w') as f:
        for i, smiles in enumerate(smiles_list):
            try:
                # Parse SMILES
                obConversion.ReadString(mol, smiles)

                # Add name
                mol.SetTitle(f"molecule_{i+1}")

                # Generate 3D coordinates
                builder = ob.OBBuilder()
                builder.Build(mol)

                # Write to SDF
                sdf_data = writer.WriteString(mol)
                f.write(sdf_data)

                print(f"Converted: {smiles}")

            except Exception as e:
                print(f"Failed to convert {smiles}: {e}")

# Usage
smiles_list = ["CCO", "c1ccccc1", "CC(=O)O"]
smiles_to_sdf_openbabel(smiles_list, "output.sdf")
```

### Command-line tools

Using OpenBabel command-line:

```bash
# Convert single SMILES
echo "CCO" | obabel -ismi -osdf --gen3d > ethanol.sdf

# Convert SMILES file
obabel -ismi molecules.smi -osdf -O molecules.sdf --gen3d

# With optimization
obabel -ismi input.smi -osdf -O output.sdf --gen3d --minimize

# Multiple conformers
obabel -ismi input.smi -osdf -O output.sdf --gen3d --conformer --nconf 10
```

Using RDKit command-line scripts:

```bash
# Basic conversion
python -c "
from rdkit import Chem
from rdkit.Chem import AllChem
supplier = Chem.SmilesMolSupplier('input.smi')
writer = Chem.SDWriter('output.sdf')
for mol in supplier:
    if mol:
        mol = Chem.AddHs(mol)
        AllChem.EmbedMolecule(mol)
        AllChem.MMFFOptimizeMolecule(mol)
        writer.write(mol)
writer.close()
"
```

### Advanced conformer generation

```python
from rdkit import Chem
from rdkit.Chem import AllChem, rdDistGeom, rdMolAlign
import numpy as np

def generate_diverse_conformers(smiles, num_confs=50, rms_threshold=0.8):
    """Generate diverse low-energy conformers from SMILES."""

    mol = Chem.MolFromSmiles(smiles)
    mol = Chem.AddHs(mol)

    # Distance geometry parameters for better conformer diversity
    params = rdDistGeom.ETKDGv3()
    params.randomSeed = 42
    params.pruneRmsThresh = rms_threshold
    params.numThreads = 0  # Use all available cores

    # Generate conformers
    conf_ids = AllChem.EmbedMultipleConfs(
        mol,
        numConfs=num_confs,
        params=params
    )

    if not conf_ids:
        return None, []

    # Optimize conformers with MMFF
    energies = []
    for conf_id in conf_ids:
        try:
            # Optimize with MMFF force field
            props = AllChem.MMFFGetMoleculeProperties(mol)
            ff = AllChem.MMFFGetMoleculeForceField(mol, props, confId=conf_id)
            if ff:
                ff.Minimize()
                energy = ff.CalcEnergy()
                energies.append((conf_id, energy))
            else:
                energies.append((conf_id, float('inf')))
        except:
            energies.append((conf_id, float('inf')))

    # Sort by energy
    energies.sort(key=lambda x: x[1])

    # Remove high-energy conformers (keep within 10 kcal/mol of minimum)
    min_energy = energies[0][1]
    filtered_confs = [
        (conf_id, energy) for conf_id, energy in energies
        if energy - min_energy < 10.0  # 10 kcal/mol threshold
    ]

    return mol, filtered_confs

# Usage
mol, conformers = generate_diverse_conformers("CC(C)C(=O)O", num_confs=100)
if mol:
    writer = Chem.SDWriter('conformers.sdf')
    for conf_id, energy in conformers[:10]:  # Write top 10
        mol.SetProp('Energy', f'{energy:.2f}')
        writer.write(mol, confId=conf_id)
    writer.close()
```

## Common use cases

SMILES to SDF conversion is essential for many computational chemistry workflows:

**Drug Discovery:**

- Converting compound libraries for virtual screening
- Preparing ligands for molecular docking studies
- Creating 3D pharmacophore models from 2D chemical databases

**Chemical Database Processing:**

- Converting ChEMBL, PubChem data to 3D structures
- Preparing datasets for machine learning models
- Creating conformer libraries for QSAR studies

**Molecular Modeling:**

- Generating starting structures for MD simulations
- Creating ligand conformers for protein-ligand studies
- Preparing molecules for quantum chemistry calculations

**Chemical Space Exploration:**

- Converting virtual compound libraries
- Generating diverse conformer sets for analysis
- Creating 3D chemical fingerprints and descriptors

**Quality considerations:**

- Generated conformers may not represent global minimum
- Ring systems require careful stereochemical handling
- Large flexible molecules need extensive conformer sampling
- Validation with experimental data recommended for critical applications

The conversion from SMILES to SDF bridges the gap between 2D chemical databases and 3D molecular modeling, enabling sophisticated computational chemistry workflows.
